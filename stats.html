<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пошук Гравця</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        /* Стилі залишаються без змін */
    </style>
</head>
<body>
    <div class="container">
        <h1>Пошук Гравця</h1>
        <label for="player-nick">Введіть нік гравця:</label>
        <input type="text" id="player-nick" placeholder="Нік гравця" />
        
        <label for="server">Виберіть сервер:</label>
        <select id="server">
            <option value="ru">RU</option>
            <option value="eu">EU</option>
            <option value="na">NA</option>
            <option value="asia">ASIA</option>
        </select>
        
        <button onclick="searchPlayer()">Пошук</button>
        <div id="result"></div>
        <div class="history">
            <h3>Історія Ніків:</h3>
            <ul id="history-list"></ul>
        </div>
    </div>

    <script>
        const APP_ID = '337a69597cd1a9343e68ec5173bbe27d';
        const AWARD_NAMES = {
            'medalCarius': 'Медаль Каріуса',
            'cadet': 'Кадет',
            'invader': 'Загарбник',
            'armorPiercer': 'Бронебійник',
            'medalEkins': 'Медаль Екінса',
            'markOfMasteryI': 'Знак майстерності I',
            'firstBlood': 'Перша кров',
            'medalKay': 'Медаль Кея',
            'firstVictory': 'Перша перемога'
        };

        function searchPlayer() {
            const nick = document.getElementById('player-nick').value.trim();
            const server = document.getElementById('server').value;
            const resultDiv = document.getElementById('result');

            if (!nick) {
                resultDiv.innerHTML = '<p class="error">Будь ласка, введіть нік гравця!</p>';
                return;
            }

            resultDiv.innerHTML = '<div class="loader"></div>';

            const url = `https://api.worldoftanks.${server}/wot/account/list/?application_id=${APP_ID}&search=${nick}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'ok' && data.data.length > 0) {
                        const playerId = data.data[0].account_id;
                        fetchPlayerInfo(playerId, server, nick);
                        updateHistory(nick);
                    } else {
                        resultDiv.innerHTML = '<p class="error">Гравця не знайдено!</p>';
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = '<p class="error">Сталася помилка при пошуку гравця. Спробуйте ще раз.</p>';
                });
        }

        function fetchPlayerInfo(playerId, server, nick) {
            const url = `https://api.worldoftanks.${server}/wot/account/info/?application_id=${APP_ID}&account_id=${playerId}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'ok') {
                        const playerData = data.data[playerId];
                        displayPlayerInfo(playerData, nick);
                    } else {
                        document.getElementById('result').innerHTML = '<p class="error">Не вдалося отримати дані гравця.</p>';
                    }
                })
                .catch(error => {
                    const resultDiv = document.getElementById('result');
                    resultDiv.innerHTML = '<p class="error">Сталася помилка при отриманні даних гравця. Спробуйте ще раз.</p>';
                });
        }

        function displayPlayerInfo(playerData, nick) {
            const resultDiv = document.getElementById('result');
            let statsHtml = `
                <h2>${nick}</h2>
                <div class="stats">
                    <h3>Основна Статистика:</h3>
                    <p>Битв: ${playerData.statistics.all.battles}</p>
                    <p>Перемог: ${playerData.statistics.all.wins}</p>
                    <p>Поразок: ${playerData.statistics.all.losses}</p>
                    <p>Знищено техніки: ${playerData.statistics.all.frags}</p>
                    <p>Процент перемог: ${(playerData.statistics.all.wins / playerData.statistics.all.battles * 100).toFixed(2)}%</p>
                </div>
            `;

            const awardsHtml = generateAwardsHtml(playerData.achievements);
            const additionalInfoHtml = generateAdditionalInfoHtml(playerData);

            resultDiv.innerHTML = `
                ${statsHtml}
                <div class="awards">${awardsHtml}</div>
                <div class="additional-info">${additionalInfoHtml}</div>
            `;
        }

        function generateAwardsHtml(achievements) {
            let awardsHtml = '<h3>Нагороди:</h3>';
            awardsHtml += '<ul>';
            for (const award in achievements) {
                if (AWARD_NAMES[award]) {
                    awardsHtml += `<li><i class="fas fa-medal"></i>${AWARD_NAMES[award]}: ${achievements[award]}</li>`;
                }
            }
            awardsHtml += '</ul>';
            return awardsHtml;
        }

        function generateAdditionalInfoHtml(playerData) {
            return `
                <h3>Додаткова Інформація:</h3>
                <p>Дата створення акаунта: ${new Date(playerData.created_at * 1000).toLocaleDateString()}</p>
                <p>Останній вхід: ${new Date(playerData.last_battle_time * 1000).toLocaleDateString()}</p>
                <p>Клан: ${playerData.clan_id ? 'Є' : 'Немає'}</p>
            `;
        }

        function updateHistory(nick) {
            const history = JSON.parse(localStorage.getItem('playerSearchHistory')) || [];
            if (!history.includes(nick)) {
                history.push(nick);
                localStorage.setItem('playerSearchHistory', JSON.stringify(history));
                renderHistory();
            }
        }

        function renderHistory() {
            const history = JSON.parse(localStorage.getItem('playerSearchHistory')) || [];
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';

            history.forEach((nick, index) => {
                const listItem = document.createElement('li');
                listItem.textContent = nick;
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Видалити';
                deleteButton.onclick = function() {
                    history.splice(index, 1);
                    localStorage.setItem('playerSearchHistory', JSON.stringify(history));
                    renderHistory();
                };
                listItem.appendChild(deleteButton);
                historyList.appendChild(listItem);
            });
        }

        // Відображення історії під час завантаження сторінки
        document.addEventListener('DOMContentLoaded', renderHistory);
    </script>
</body>
</html>
